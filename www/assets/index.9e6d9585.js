var Oe=Object.defineProperty,Te=Object.defineProperties;var Fe=Object.getOwnPropertyDescriptors;var ne=Object.getOwnPropertySymbols;var Ke=Object.prototype.hasOwnProperty,$e=Object.prototype.propertyIsEnumerable;var re=(e,o,m)=>o in e?Oe(e,o,{enumerable:!0,configurable:!0,writable:!0,value:m}):e[o]=m,ae=(e,o)=>{for(var m in o||(o={}))Ke.call(o,m)&&re(e,m,o[m]);if(ne)for(var m of ne(o))$e.call(o,m)&&re(e,m,o[m]);return e},se=(e,o)=>Te(e,Fe(o));import{d as de,r as p,c as B,b as ue,q as c,t as y,y as q,k as a,x as t,S as w,R as v,z as P,F as ie,a as M,f as De,a6 as pe,a3 as Ee,a4 as j,v as G,a5 as Ve,D as te,X as je,n as ze,M as z}from"./ant-design-vue.a8492f24.js";import{g as Q,s as Le}from"./dictFormat.79b1e255.js";import{g as ce}from"./index.2a7799e3.js";import{g as Ae,d as Be,l as qe,u as Me,e as Qe,r as _e}from"./index.0b76cf6a.js";import{g as Xe}from"./index.b9cef699.js";import{_ as me,u as Ge,a as He,h as fe}from"./index.aca53cb1.js";import{u as Je}from"./useDrawer.7609ab11.js";import{T as We,f as ve}from"./validate.2b61bb0c.js";import{u as he}from"./useI18n.a6aa6aed.js";import{F as Ye}from"./index.44bfdde0.js";const Ze=de({props:{data:{type:Array,required:!0},original:{type:Array,default:()=>[]},baseFields:{type:Object,default:()=>({children:"children",title:"title",key:"id"})}},emits:["select"],setup(e,{emit:o}){const{t:m}=he(),k=p(""),R=p([]),S=p([]),g=p(!0),u=B(()=>e.data),I=B(()=>e.baseFields),d=B(()=>e.original),F=h=>{S.value=h,g.value=!1},C=h=>{o("select",h)};return ue(k,h=>{const L=d.value.map(n=>n.deptName.indexOf(h)>-1?n.deptId:null).filter((n,N,U)=>n&&U.indexOf(n)===N);S.value=L,k.value=h,g.value=!0}),ue(R,h=>{console.log("selectedKeys",h)}),{t:m,searchValue:k,expandedKeys:S,autoExpandParent:g,deptTreeOption:u,replaceFields:I,selectedKeys:R,onExpand:F,handleSelect:C}}}),xe={key:0},ea={class:"text-red-400"},aa={key:1};function sa(e,o,m,k,R,S){const g=c("svg-icon"),u=c("a-input"),I=c("a-tree");return y(),q(ie,null,[a(u,{allowClear:!0,value:e.searchValue,"onUpdate:value":o[0]||(o[0]=d=>e.searchValue=d),placeholder:e.t("component.deptSearch.placeholder")},{prefix:t(()=>[a(g,{name:"search",class:"text-[#d9d9d9]"})]),_:1},8,["value","placeholder"]),a(I,{blockNode:!0,expandedKeys:e.expandedKeys,"auto-expand-parent":e.autoExpandParent,"replace-fields":e.replaceFields,"tree-data":e.deptTreeOption,selectedKeys:e.selectedKeys,"onUpdate:selectedKeys":o[1]||(o[1]=d=>e.selectedKeys=d),onExpand:e.onExpand,onSelect:e.handleSelect},{title:t(({deptName:d})=>[d.indexOf(e.searchValue)>-1?(y(),q("span",xe,[w(v(d.substr(0,d.indexOf(e.searchValue)))+" ",1),P("span",ea,v(e.searchValue),1),w(" "+v(d.substr(d.indexOf(e.searchValue)+e.searchValue.length)),1)])):(y(),q("span",aa,v(d),1))]),_:1},8,["expandedKeys","auto-expand-parent","replace-fields","tree-data","selectedKeys","onExpand","onSelect"])],64)}var ta=me(Ze,[["render",sa]]);const{t:i}=he(),oa=[{title:i("routes.user.userName"),dataIndex:"userName",key:"userName",align:"center"},{title:i("routes.user.nickName"),dataIndex:"nickName",key:"nickName",align:"center"},{title:i("routes.user.roleIds"),key:"roles",align:"center",slots:{customRender:"roles"}},{title:i("routes.user.department"),key:"department",align:"center",slots:{customRender:"department"}},{title:i("routes.user.mobile"),key:"mobile",dataIndex:"mobile",align:"center"},{title:i("routes.user.status"),dataIndex:"status",key:"status",align:"center",slots:{customRender:"status"}},{title:i("routes.user.createdAt"),dataIndex:"createdAt",key:"createdAt",align:"center"},{title:i("routes.user.action"),key:"action",align:"center",slots:{customRender:"action"}}],la=de({components:{Treeselect:We,DeptSearch:ta,FormSearch:Ye},setup(){const e=Ge(),o=B(()=>He().loading),m=p([]),k=p([]),R=p([]),S=p([]),g=p([]),u=p([]),I=p(),d=p([]),F={children:"children",title:"deptName",key:"deptId"},C=p([]),h=s=>{n.deptId=s[0],U(n)},L=p(),n=M({userName:"",deptId:0,roleId:"",pageNum:1,pageSize:10}),N=M([{type:"input",label:i("routes.user.userName"),name:"userName",value:void 0,placeholder:i("routes.user.userNamePlaceholder")},{type:"select",label:i("routes.user.roleIds"),name:"roleId",value:void 0,placeholder:i("routes.user.roleIdsPlaceholder"),normalizer:{value:"id",label:"roleName"},options:m}]),U=s=>{b.value.current=1,n.pageNum=b.value.current,n.userName=s.userName,n.roleId=s.roleId,D(n)},K=M({selectedRowKeys:[]}),$=p([]),b=p({total:0,current:1,pageSize:10,showSizeChanger:!0,showTotal:s=>`\u5171 ${s} \u6761`}),H=s=>{b.value=s,n.pageNum=b.value.current,n.pageSize=b.value.pageSize,D(n)},J=B(()=>K.selectedRowKeys.length>0),W=s=>{K.selectedRowKeys=s},Y=s=>s.roles.map(f=>f.roleName).join(","),O=()=>{E.value=!0,ee.value=!1,x.value=i("common.add")},l=s=>{Ae(s.id).then(f=>{E.value=!0,ee.value=!0,x.value=i("common.update"),ze(()=>{Object.keys(r).forEach(V=>{r[V]=f.data[V]}),r.roleIds=f.data.roles.map(V=>V.id),oe.value.forest.selectedNodeIds.push(f.data.deptId),console.log(r)})})},_=s=>{const f=s.id||K.selectedRowKeys;console.log(f),Be(f).then(()=>{(f.length&&f.length===$.value.length||$.value.length===1)&&Math.ceil(b.value.total/n.pageSize)===n.pageNum&&n.pageNum>1&&n.pageNum--,D(n),z.success(i("common.deleteSuccess"))})},ge=s=>{console.log(s),z.success(i("common.cancelDelete"))},Z=p([]),D=s=>{qe(s).then(f=>{$.value=f.data.rows,b.value.total=f.data.count}),ce().then(f=>{const V=fe(f.data.rows,"deptId","parentId","children",e.userInfo.deptId).tree,le=f.data.rows.filter(Ue=>Ue.deptId===e.userInfo.deptId);le[0].children=V,Z.value=le,console.log(Z)})},oe=p(),r=M({id:void 0,deptId:void 0,nickName:void 0,userName:void 0,password:void 0,sex:"1",roleIds:[],mobile:void 0,status:"1",email:void 0,remark:void 0}),be={deptId:[{required:!0,validator:ve.number,message:i("routes.user.deptIdCannotBeEmpty"),trigger:"change"}],nickName:[{required:!0,message:i("routes.user.nickNameCannotBeEmpty"),trigger:"blur"}],userName:[{required:!0,message:i("routes.user.userNameCannotBeEmpty"),trigger:"blur"}],password:[{required:!0,message:i("routes.user.passwordCannotBeEmpty"),trigger:"blur"}],roleIds:[{required:!0,validator:ve.checkRoleLength,trigger:"change"}]},{open:E,drawerTitle:x}=Je(),ee=p(!1),we=s=>{r.deptId=s.deptId},A=p(),ye=()=>{console.log(r),A.value.validate().then(()=>{r.id?Me(r).then(s=>{z.success(s.message),r.id=void 0,r.deptId=void 0,r.password=void 0,r.userName=void 0,r.roleIds=void 0,A.value.resetFields(),E.value=!1,D(n)}):Qe(r).then(s=>{z.success(s.message),r.id=void 0,r.deptId=void 0,r.password=void 0,r.userName=void 0,r.roleIds=void 0,A.value.resetFields(),E.value=!1,D(n)})}).catch(s=>{console.log("error",s)})},ke=s=>(s.children&&!s.children.length&&delete s.children,{id:s.deptId,label:s.deptName,children:s.children}),Se=()=>{r.id=void 0,r.deptId=void 0,r.password=void 0,r.userName=void 0,A.value.resetFields(),console.log(r),E.value=!1},X=p(!1),T=M({id:0,newPassword:""}),Ie=s=>{T.id=s.id,X.value=!0},Ce=()=>{if(!T.newPassword){z.error(i("routes.user.newPasswordCannotBeEmpty"));return}_e(T.id,{newPassword:T.newPassword}).then(s=>{z.success(s.message),T.newPassword="",X.value=!1})},Ne=()=>{T.newPassword="",X.value=!1},Pe=()=>{ce().then(s=>{d.value=s.data.rows,C.value=fe(s.data.rows,"deptId","parentId","children",0).tree,I.value.expandedKeys.value=d.value.map(f=>f.id)})},Re=()=>{Pe(),D(n),Xe().then(s=>{m.value=s.data.rows})};return De(async()=>{k.value=await Q("sys_normal_disable"),R.value=await Q("sys_user_position"),S.value=await Q("sys_user_education"),g.value=await Q("sys_normal_disable"),u.value=await Q("sys_user_sex"),g.value.forEach(s=>{s.label=s.dictLabel,s.value=s.dictValue}),u.value.forEach(s=>{s.label=s.dictLabel,s.value=s.dictValue}),Re()}),se(ae(se(ae({t:i,loading:o,replaceFields:F,deptSearchRef:I,originalTree:d,deptTreeOption:C,handleSelect:h,queryRef:L,queryParams:n,formFields:N,handleQuery:U,statusOptions:k,columns:oa},pe(K)),{userList:$,pagination:b,handleTableChange:H,selectDictLabel:Le,hasSelected:J,onSelectChange:W,getRoles:Y,confirm:_,cancel:ge,handleAdd:O,handleUpdate:l,treeRef:oe,formRef:A,rules:be,isUpdate:ee,open:E,drawerTitle:x,deptOptions:Z,normalizer:ke,handleClose:Se,handleSubmit:ye,labelCol:{span:6},wrapperCol:{span:18},formState:r,roleOptions:m,handleTreeSelect:we,positionOptions:R,educationOptions:S,disableOptions:g,sexOptions:u,visible:X}),pe(T)),{handleResetPwd:Ce,handleResetClose:Ne,showModal:Ie})}}),na={class:"p-4"},ra={class:"mb-3"},da={class:"flex items-center"},ua={class:"whitespace-nowrap"};function ia(e,o,m,k,R,S){const g=c("dept-search"),u=c("a-col"),I=c("form-search"),d=c("a-button"),F=c("a-popconfirm"),C=c("a-row"),h=c("a-table"),L=c("treeselect"),n=c("a-form-item"),N=c("a-input"),U=c("a-input-password"),K=c("a-select-option"),$=c("a-select"),b=c("a-radio-group"),H=c("a-textarea"),J=c("a-form"),W=c("a-drawer"),Y=c("a-modal"),O=Ee("has-permi");return y(),q("div",na,[a(C,{gutter:15},{default:t(()=>[a(u,{span:4},{default:t(()=>[a(g,{ref:"deptSearchRef",original:e.originalTree,data:e.deptTreeOption,baseFields:e.replaceFields,onSelect:e.handleSelect},null,8,["original","data","baseFields","onSelect"])]),_:1}),a(u,{span:20},{default:t(()=>[P("div",ra,[a(I,{formFields:e.formFields,onSearch:e.handleQuery,onReset:e.handleQuery},null,8,["formFields","onSearch","onReset"])]),a(C,{gutter:10,class:"mb-2"},{default:t(()=>[j(a(u,null,{default:t(()=>[a(d,{color:"success",onClick:e.handleAdd},{default:t(()=>[w(v(e.t("common.add")),1)]),_:1},8,["onClick"])]),_:1},512),[[O,["system:user:add"]]]),j(a(u,null,{default:t(()=>[a(F,{title:e.t("common.confirmDelete"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:e.confirm,onCancel:e.cancel},{default:t(()=>[a(d,{disabled:!e.hasSelected,color:"error"},{default:t(()=>[w(v(e.t("common.delete")),1)]),_:1},8,["disabled"])]),_:1},8,["title","ok-text","cancel-text","onConfirm","onCancel"])]),_:1},512),[[O,["system:user:delete"]]])]),_:1}),a(h,{loading:e.loading,rowKey:"id","row-selection":{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},columns:e.columns,"data-source":e.userList,pagination:e.pagination,onChange:e.handleTableChange},{department:t(({record:l})=>[P("span",null,v(l.department.deptName),1)]),status:t(({record:l})=>[P("span",null,v(e.selectDictLabel(e.statusOptions,l.status)),1)]),roles:t(({record:l})=>[P("span",null,v(e.getRoles(l)),1)]),action:t(({record:l})=>[P("span",null,[j(a(d,{type:"link",color:"success",class:"mr-3",onClick:_=>e.handleUpdate(l)},{default:t(()=>[w(v(e.t("common.update")),1)]),_:2},1032,["onClick"]),[[O,["system:user:update"]]]),j(a(d,{type:"link",color:"success",class:"mr-3",onClick:_=>e.showModal(l)},{default:t(()=>[w(v(e.t("routes.user.resetPwd")),1)]),_:2},1032,["onClick"]),[[O,["system:user:resetPwd"]]]),a(F,{title:e.t("common.confirmDelete"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:_=>e.confirm(l),onCancel:e.cancel},{default:t(()=>[j(a(d,{type:"link",color:"error"},{default:t(()=>[w(v(e.t("common.delete")),1)]),_:1},512),[[O,["system:user:delete"]]])]),_:2},1032,["title","ok-text","cancel-text","onConfirm","onCancel"])])]),_:1},8,["loading","row-selection","columns","data-source","pagination","onChange"])]),_:1})]),_:1}),a(W,{width:"50%",title:e.drawerTitle,placement:"right",visible:e.open,"onUpdate:visible":o[10]||(o[10]=l=>e.open=l),maskClosable:!1,onClose:e.handleClose},{default:t(()=>[e.open?(y(),G(J,{key:0,ref:"formRef",model:e.formState,rules:e.rules,"label-col":e.labelCol,"wrapper-col":e.wrapperCol},{default:t(()=>[a(C,null,{default:t(()=>[j(a(u,{span:12},{default:t(()=>[a(n,{label:e.t("routes.user.deptId"),name:"deptId"},{default:t(()=>[a(L,{ref:"treeRef",class:"!mt-[3px]",value:e.formState.deptId,"onUpdate:value":o[0]||(o[0]=l=>e.formState.deptId=l),normalizer:e.normalizer,placeholder:e.t("routes.user.deptIdPlaceholder"),options:e.deptOptions,onSelect:e.handleTreeSelect},null,8,["value","normalizer","placeholder","options","onSelect"])]),_:1},8,["label"])]),_:1},512),[[Ve,e.formState.deptId!==0]]),a(u,{span:12},{default:t(()=>[a(n,{label:e.t("routes.user.nickName"),name:"nickName"},{default:t(()=>[a(N,{value:e.formState.nickName,"onUpdate:value":o[1]||(o[1]=l=>e.formState.nickName=l),placeholder:e.t("routes.user.nickNamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),e.isUpdate?te("",!0):(y(),G(u,{key:0,span:12},{default:t(()=>[a(n,{label:e.t("routes.user.userName"),name:"userName"},{default:t(()=>[a(N,{value:e.formState.userName,"onUpdate:value":o[2]||(o[2]=l=>e.formState.userName=l),placeholder:e.t("routes.user.userNamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1})),e.isUpdate?te("",!0):(y(),G(u,{key:1,span:12},{default:t(()=>[a(n,{label:e.t("routes.user.password"),name:"password"},{default:t(()=>[a(U,{value:e.formState.password,"onUpdate:value":o[3]||(o[3]=l=>e.formState.password=l),placeholder:e.t("routes.user.passwordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1})),a(u,{span:12},{default:t(()=>[a(n,{label:e.t("routes.user.roleIds"),name:"roleIds"},{default:t(()=>[a($,{mode:"multiple",value:e.formState.roleIds,"onUpdate:value":o[4]||(o[4]=l=>e.formState.roleIds=l),placeholder:e.t("routes.user.roleIdsPlaceholder")},{default:t(()=>[(y(!0),q(ie,null,je(e.roleOptions,l=>(y(),G(K,{key:l.id},{default:t(()=>[w(v(l.roleName),1)]),_:2},1024))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),a(u,{span:12},{default:t(()=>[a(n,{label:e.t("routes.user.sex"),name:"sex"},{default:t(()=>[a(b,{value:e.formState.sex,"onUpdate:value":o[5]||(o[5]=l=>e.formState.sex=l),options:e.sexOptions},null,8,["value","options"])]),_:1},8,["label"])]),_:1}),a(u,{span:12},{default:t(()=>[a(n,{label:e.t("routes.user.mobile"),name:"mobile"},{default:t(()=>[a(N,{value:e.formState.mobile,"onUpdate:value":o[6]||(o[6]=l=>e.formState.mobile=l),placeholder:e.t("routes.user.mobilePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),a(u,{span:12},{default:t(()=>[a(n,{label:e.t("routes.user.status"),name:"status"},{default:t(()=>[a(b,{value:e.formState.status,"onUpdate:value":o[7]||(o[7]=l=>e.formState.status=l),options:e.disableOptions},null,8,["value","options"])]),_:1},8,["label"])]),_:1}),a(u,{span:12},{default:t(()=>[a(n,{label:e.t("routes.user.email"),name:"email"},{default:t(()=>[a(N,{value:e.formState.email,"onUpdate:value":o[8]||(o[8]=l=>e.formState.email=l),placeholder:e.t("routes.user.emailPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),a(u,{span:12},{default:t(()=>[a(n,{label:e.t("routes.user.remark"),name:"remark"},{default:t(()=>[a(H,{rows:3,value:e.formState.remark,"onUpdate:value":o[9]||(o[9]=l=>e.formState.remark=l),placeholder:e.t("routes.user.remarkPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),a(u,{span:24},{default:t(()=>[a(n,null,{default:t(()=>[a(d,{type:"primary",class:"mr-3",onClick:e.handleSubmit},{default:t(()=>[w(v(e.t("common.okText")),1)]),_:1},8,["onClick"]),a(d,{onClick:e.handleClose},{default:t(()=>[w(v(e.t("common.cancelText")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules","label-col","wrapper-col"])):te("",!0)]),_:1},8,["title","visible","onClose"]),a(Y,{visible:e.visible,"onUpdate:visible":o[12]||(o[12]=l=>e.visible=l),title:e.t("routes.user.resetPwd"),onOk:e.handleResetPwd,onCancel:e.handleResetClose},{default:t(()=>[P("div",da,[P("span",ua,v(e.t("routes.user.newPassword"))+"\uFF1A",1),a(U,{value:e.newPassword,"onUpdate:value":o[11]||(o[11]=l=>e.newPassword=l),placeholder:e.t("routes.user.newPasswordPlaceholder")},null,8,["value","placeholder"])])]),_:1},8,["visible","title","onOk","onCancel"])])}var Sa=me(la,[["render",ia]]);export{Sa as default};
